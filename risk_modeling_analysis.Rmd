---
title: "Wedding Invitations - Risk Modeling (Version 2.0)"
author: "Bryan Clark"
date: "20202-08-29"
output:
  html_document:
    highlight: default
    theme: cosmo
    toc: yes
    toc_float: yes
    df_print: kable
---

NOTES:
+ convert class into package
+ incorporate python code in R package
+ create unit tests

```{r setup, include = FALSE}
# customize output options 
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE,
                      fig.width = 6, fig.asp = 0.618, out.width = "70%", 
                      fig.align = "center")

# rmarkdown
library(knitr)
library(kableExtra)

# python
library(reticulate)
use_miniconda("wedding_risk", required = TRUE)
#reticulate::use_virtualenv(fs::path(here::here(), "venv"), required = T)
py_path <- fs::path(here::here(), "py", "simulator.py")
source_python(py_path)

# core
library(tidyverse)

# set theme for plots
theme_set(theme_minimal(base_family = "Avenir"))

# Color-blind palette with grey:
cb_palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73",
                "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# TL;DR

## Context

Last year I got a taste of the power of shiny. 
Just finished Shing with AWS course. 
Want to find a good way to apply learnings and continue progress of shiny app deployment. 

## Goals

+ Create shiny app project library to reinforce learnings from Shiny with AWS course
+ Practice setting up docker with R and Python
+ 

## Solution

+ Launch the start of Shiny Business Analytics with a remix of the Wedding Invitiation Risk Modeling App. 

# Monte Carlo Simulation

+ Describe benefits (mention Fooled By Randomness)
+ Outline three approaches to support (fixed, equal range, best/worst/most likely triangle) and reasoning
  + User reasons
  + Shiny App learning reasons (dynamically change inputs based on selection)

# Shiny App

## 1. User Inputs

```{r}
# number of people invited
invites <- 150

# total budget
budget <- 30000

# risk tolerance
risk_tolerance <- .20

# inputs for total cost calculation
fixed_cost <- 22000
guest_base <- 50
variable_guest_cost <- 125
```

## 2. Simulation

### 3.2 Run Simulation

```{r}
simulation = py$RiskSimulator(k = 10000, 
                              n = 150, 
                              p = list('left' = .60, 'mode' = .75, 'right' = .90),
                              fixed_cost = 22000, 
                              variable_guest_cost = 125, 
                              guest_base = 50, 
                              budget = 30000,
                              risk_tolerance = 0.2,
                              distribution = 'triangular')

simulation$run()
```

### 3.3 Provide Recommendation

```{r}
simulation$get_recommendation()
```

## 4. Plot Results

### 4.1 Functions

```{r}
# plot.R
source("R/plot.R")
```

### 4.2 Plot Guest Count

```{r}
simulation$risk_tolerance
```


```{r}
plot_guest_count(simulation$simulation_data)
```

### 4.3 Plot Cost

```{r}
plot_cost(simulation$simulation_data)
```

### 4.4 Plot Risk

```{r}
plot_risk(simulation$simulation_data)
```

### 4.5 Plot Recommendation

```{r}
plot_recommendation(simulation)
```

## 5. Financial Outcomes

### 5.1 Upside Potential

```{r}
simulation$financial_upside
```

### 5.2 Downside Risk

```{r}
simulation$financial_risk
```

### 5.3 Overall Expectation

```{r}
simulation$overall_expectation
```

